<!DOCTYPE html>
<html lang="de">
<head>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCSn9mCvNT6JZgXy5ZTIOeVhri4FQRvn9E",
    authDomain: "sigma-the-game.firebaseapp.com",
    projectId: "sigma-the-game",
    storageBucket: "sigma-the-game.appspot.com",
    messagingSenderId: "346310580482",
    appId: "1:346310580482:web:a7e6f835eb4dd541964a1b"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sigma The Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;700&display=swap');
    
    :root {
      --main-bg: #0c0c14;
      --card-bg: #1a1a24;
      --accent-color: #ffce00;
      --accent-glow: rgba(255, 206, 0, 0.6);
      --hover-glow: rgba(255, 206, 0, 0.3);
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --locked-color: #444444;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: all 0.3s ease;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #0c0c14 0%, #151530 100%);
      color: var(--text-primary);
      text-align: center;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(37, 37, 135, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(45, 40, 125, 0.1) 0%, transparent 50%);
      pointer-events: none;
    }
    
    .menu-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 40px 20px;
      gap: 30px;
      position: relative;
      z-index: 1;
    }
    
    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 48px;
      font-weight: 900;
      letter-spacing: 3px;
      margin-top: 30px;
      text-shadow: 0 0 15px rgba(255, 206, 0, 0.5),
                   0 0 30px rgba(255, 206, 0, 0.2);
      animation: title-glow 3s infinite alternate;
      background: linear-gradient(to right, #fff, var(--accent-color), #fff);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
    }
    
    h3 {
      font-family: 'Orbitron', sans-serif;
      margin-bottom: 5px;
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 1px;
      color: var(--text-primary);
      opacity: 0;
      animation: fade-in 0.8s forwards 0.5s;
    }
    input[type="text"] {
      padding: 12px 20px;
      font-size: 16px;
      width: 300px;
      max-width: 90%;
      border-radius: 30px;
      border: 2px solid transparent;
      background-color: rgba(255, 255, 255, 0.08);
      color: var(--text-primary);
      text-align: center;
      outline: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transform: translateY(-20px); /* weiter oben */
      margin-bottom: 30px; /* ⬅️ mehr Abstand nach unten */
      opacity: 0;
      animation: slide-up 0.33s forwards 0.3s;
    }
 
    input[type="text"]:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 15px var(--accent-glow);
    }
    
    input[type="text"]::placeholder {
      color: var(--text-secondary);
      opacity: 0.7;
    }
    
    .passive-selection {
      display: flex;
      gap: 25px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 10px 0 30px;
      perspective: 1000px;
      opacity: 0;
      animation: fade-in 0.8s forwards 0.7s;
    }
    
    .passive-option {
      background: linear-gradient(145deg, var(--card-bg), #232335);
      padding: 22px 18px;
      border-radius: 12px;
      border: 2px solid #333344;
      width: 220px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
      transform: translateZ(0);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .passive-option:hover:not(.locked) {
      transform: translateY(-10px) scale(1.03);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 15px var(--hover-glow);
      border-color: rgba(255, 206, 0, 0.4);
    }
    
    .passive-option::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.6s ease;
      z-index: -1;
    }
    
    .passive-option:hover:not(.locked)::before {
      opacity: 0.15;
      transform: scale(1);
    }
    
    .passive-option.locked {
      opacity: 0.6;
      background: linear-gradient(145deg, #1a1a24, #252530);
      border-color: var(--locked-color);
      pointer-events: none;
      filter: grayscale(50%);
    }
    
    .passive-option.active {
      border-color: var(--accent-color);
      box-shadow: 0 0 20px var(--accent-glow);
      transform: translateY(-5px);
    }
    
    .passive-option.active:hover {
      transform: translateY(-10px) scale(1.03);
    }
    
    .passive-option strong {
      display: block;
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      margin-bottom: 8px;
      color: var(--accent-color);
      position: relative;
      transform: translateZ(10px);
    }
    
    .passive-option p {
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 10px;
      color: var(--text-primary);
      transform: translateZ(5px);
    }
    
    .passive-option em {
      display: block;
      font-size: 12px;
      font-style: italic;
      color: var(--text-secondary);
      margin-top: 8px;
      transform: translateZ(5px);
    }
    
    .new-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: var(--accent-color);
      color: black;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: bold;
      transform: rotate(15deg);
      animation: pulse 1.5s infinite alternate;
    }
    
    button {
      padding: 14px 34px;
      font-size: 18px;
      font-family: 'Orbitron', sans-serif;
      letter-spacing: 1px;
      border-radius: 30px;
      border: none;
      background: linear-gradient(135deg, var(--accent-color), #ffa200);
      color: #111;
      font-weight: bold;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 15px rgba(255, 206, 0, 0.4);
      transform: translateY(20px);
      opacity: 0;
      animation: slide-up 0.6s forwards 0.1s;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, transparent 60%);
      opacity: 0;
      transition: opacity 0.4s ease;
      transform: translate(-100px, -100px) scale(0.1);
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4), 0 0 20px rgba(255, 206, 0, 0.6);
    }
    
    button:active {
      transform: translateY(2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    button:hover::before {
      opacity: 0.3;
      transform: translate(100px, 100px) scale(3);
      transition: transform 1s ease, opacity 0.4s ease;
    }
    
    @keyframes title-glow {
      0%, 20% {
        text-shadow: 0 0 15px rgba(255, 206, 0, 0.5),
                     0 0 30px rgba(255, 206, 0, 0.2);
      }
      80%, 100% {
        text-shadow: 0 0 20px rgba(255, 206, 0, 0.7),
                     0 0 40px rgba(255, 206, 0, 0.4),
                     0 0 60px rgba(255, 206, 0, 0.2);
      }
    }
    
    @keyframes slide-up {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fade-in {
      to {
        opacity: 1;
      }
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1) rotate(15deg);
      }
      100% {
        transform: scale(1.1) rotate(15deg);
      }
    }
    
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: var(--accent-color);
      border-radius: 50%;
      opacity: 0.2;
      animation: float 20s linear infinite;
    }

    @keyframes float {
      0% {
        transform: translateY(0) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.5;
      }
      90% {
        opacity: 0.5;
      }
      100% {
        transform: translateY(-800px) translateX(100px) rotate(360deg);
        opacity: 0;
      }
    }
    
    @media (max-width: 768px) {
      .passive-selection {
        gap: 15px;
      }
      
      .passive-option {
        width: 180px;
        padding: 15px;
      }
      
      h1 {
        font-size: 36px;
      }
      
      button {
        padding: 12px 28px;
        font-size: 16px;
      }
    }

    @media (max-width: 480px) {
      .passive-option {
        width: 90%;
        max-width: 280px;
      }
    }

.title-container {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 180px; /* passt vertikal den Abstand an */
  margin-bottom: 40px;
}

.subtitle-tilted {
  position: absolute;
  top: 110px; /* <- Statt 20px */
  left: 70%;
  transform: translateX(-190px) rotate(-18deg);
  font-size: 20px;
  font-family: 'Orbitron', sans-serif;
  font-weight: bold;
  color: yellow;
  animation: pulseSplash 2.5s infinite ease-in-out;
  pointer-events: none;
  white-space: nowrap;
}




@keyframes pulseSplash {
  0%, 100% {
    transform: scale(1) rotate(-18deg);
  }
  50% {
    transform: scale(1.12) rotate(-18deg);
  }
}




  </style>
</head>
<body>
  <div class="particles" id="particles"></div>

  <!-- Patch Notes Button -->
<div style="position: fixed; top: 15px; right: 15px; z-index: 999;">
  <button onclick="openPatchNotes()" title="Patch Notes anzeigen" style="padding: 6px 14px; font-size: 14px;">📝 Patch Notes</button>
</div>

<!-- Patch Notes Modal -->
<div id="patchNotesModal" style="display: none;">
  <div style="
    position: fixed;
    top: 10%;
    right: 5%;
    width: 90%;
    max-width: 500px;
    max-height: 70vh;
    overflow-y: auto;
    background-color: var(--card-bg);
    color: var(--text-primary);
    border: 2px solid var(--accent-color);
    border-radius: 12px;
    padding: 20px;
    z-index: 1001;
    box-shadow: 0 0 25px var(--accent-glow);
  ">
    <h2 style="margin-bottom: 10px;">📝 CASE OPENING IST DA</h2>
    <div id="patchNotesContent" style="text-align: left; font-family: monospace; font-size: 14px;">
      <p><strong>v1.22</strong> – 08. Mai 2025</p>
      <ul>
        <li>Bagdo ist da!</li>
        <li>Es gibt jetzt Belohnungen!</li>
      </ul>
    </div>
  </div>
</div>


<div class="menu-container" id="mainMenu">
  <div class="title-container">
    <h1>SIGMA THE GAME</h1>
    <div class="subtitle-tilted">Bagdo ist da! + Neuer Skin</div>
  </div>

    <input type="text" id="playerNameInput" placeholder="Spielername eingeben" maxlength="15" autocomplete="off" required />
    <h3>Wähle eine passive Fähigkeit</h3>

    <div class="passive-selection">
      <div class="passive-option active" data-passive="swordfighter">
        <strong>Schwertkämpfer</strong>
        <p>Schwert macht +3 Schaden</p>
      </div>

      <div class="passive-option" data-passive="shieldmaster">
        <strong>Schildmeister</strong>
        <p>Jede Runde +5 Schild.<br/>Schwerter machen -1 Schaden.</p>
      </div>
      
      <div class="passive-option" data-passive="martyr">
        <strong>Märtyrer</strong>
        <p>Bonus-Schaden je mehr Leben dir fehlt.</p>
      </div>      

      <div class="passive-option locked" data-passive="goldboy">
        <strong>Goldjunge</strong>
        <p>Starte mit 2000 Gold</p>
        <em>Freigeschaltet nach Sieg über Nekromant</em>
      </div>   

      <div class="passive-option locked" data-passive="dragonscale">
        <strong>Drachenschuppen</strong>
        <p>Immun gegen Statuseffekte. JEDE Attacke überträgt starke Verbennungen. 6 Schaden für 2 Runden</p>
        <em>Freigeschaltet nach Sieg über Drache</em>
      </div>

      <div class="passive-option locked" data-passive="undead">
        <strong>Totenbeschwörer</strong>
        <p>Beschwöre einen Teufelshund an deiner Seite.<br/>Verbesserbar mit Totenkeule.</p>
        <em>Freigeschaltet nach Sieg über Teufel</em>
      </div>   
    </div>
    
    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; align-items: flex-end;">
       <!-- Starter Deck -->
       <button onclick="showStarterDeckSelection()" style="padding: 18px 38px; font-size: 20px;">
       🃏 Deck
      </button>
      <!-- Neues Spiel starten -->
      <button onclick="startGame()" id="startButton" style="padding: 18px 38px; font-size: 20px;">
        Neues Spiel starten
      </button>
    

      <!-- Menü-Button + Dropdown (öffnet nach oben) -->
      <div style="position: relative; display: inline-block;">
        <button onclick="toggleMenu()" style="padding: 10px 18px; font-size: 28px;">
          ☰
        </button>
        <div id="menuDropdown" style="
          display: none;
          position: absolute;
          bottom: 110%; /* Öffnet nach oben */
          left: 0;
          background: rgba(253, 165, 0, 0.85);
          border-radius: 8px;
          padding: 12px;
          box-shadow: 0 0 15px rgba(255,255,255,0.1);
          font-family: 'Orbitron', sans-serif;
          min-width: 160px;
          text-align: left;
          z-index: 1000;
        ">
          <!-- Menü-Dropdown -->
           <button onclick="openAchievementsModal()">🏆 Erfolge</button>
        <button id="monsterWikiButton" onclick="document.getElementById('monsterWikiModal').style.display='block'">
          Monster Wiki
        </button>
        <button id="cardWikiButton"    onclick="document.getElementById('cardWikiModal').style.display='block'">
          Karten Wiki
        </button>
          <button onclick="openLootboxMenu()" style="display: block; width: 100%;">Cases</button>
        </div>
      </div>
    </div>
      

    <div id="leaderboardDisplay" style="margin-top: 30px;">
      <h3>🏆 Highscore-Liste</h3>
      <ol id="leaderboardList" style="text-align: mid; font-size: 18px; max-width: 300px; margin: 0 auto; font-family: monospace;"></ol>
    </div>
    


  <div id="monsterWikiModal" style="display:none;">
    <div style="
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 850px;
      max-height: 80vh;
      overflow-y: auto;
      background-color: var(--card-bg);
      color: var(--text-primary);
      border: 2px solid var(--accent-color);
      border-radius: 12px;
      padding: 20px;
      z-index: 1000;
      box-shadow: 0 0 30px var(--accent-glow);
    ">
      <h2 style="margin-bottom: 15px;">🧟 Monster-Wiki</h2>
      <div id="monsterList" style="text-align: left; font-family: monospace;"></div>
      <button onclick="closeMonsterWiki()" style="margin-top: 20px;">Schließen</button>
    </div>
  </div>
  
  <div id="cardWikiModal" style="display:none;">
    <div style="
      position: fixed;
      top: 8%;
      left: 50%;
      transform: translateX(-50%);
      width: 95%;
      max-width: 1000px;
      max-height: 80vh;
      overflow-y: auto;
      background-color: var(--card-bg);
      color: var(--text-primary);
      border: 2px solid var(--accent-color);
      border-radius: 12px;
      padding: 20px;
      z-index: 1000;
      box-shadow: 0 0 30px var(--accent-glow);
    ">
      <h2 style="margin-bottom: 15px;">🃏 Karten-Wiki</h2>
      <div id="cardList" style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 15px;
      "></div>
      <button onclick="closeCardWiki()" style="margin-top: 20px;">Schließen</button>
    </div>
  </div>

<div id="achievementsModal" style="
  display: none;
  position: fixed;
  top: 10%;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 800px;
  max-height: 80vh;
  overflow-y: auto;
  background: #1a1a24;
  border: 3px solid gold;
  border-radius: 12px;
  padding: 20px;
  z-index: 9999;
  box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
  color: white;
">
  <div id="achievementList"></div>
</div>


  

  <script>
if (!window.cards || !window.cards.length) {
  window.cards = JSON.parse(localStorage.getItem('allCards') || '[]');
}

document.addEventListener('DOMContentLoaded', () => {
  // 💎 Gems
  function getGems() {
    return parseInt(localStorage.getItem('gems') || '0', 10);
  }

  const gemDisplay = document.createElement('div');
  gemDisplay.id = 'gemDisplay';
  Object.assign(gemDisplay.style, {
    position: 'fixed',
    top: '15px',
    left: '15px',
    zIndex: '999',
    background: 'rgba(0, 0, 0, 0.5)',
    padding: '6px 12px',
    borderRadius: '8px',
    fontSize: '16px',
    color: 'gold',
    fontFamily: 'Orbitron, sans-serif',
    boxShadow: '0 0 8px rgba(255, 206, 0, 0.5)',
    cursor: 'default'
  });
  document.body.appendChild(gemDisplay);

  function updateGemDisplay() {
    gemDisplay.innerHTML = `💎 <strong>${getGems()}</strong>`;
  }
  updateGemDisplay();
  window.updateGemDisplay = updateGemDisplay;

  gemDisplay.addEventListener('mouseenter', () => {
    const tip = document.createElement('div');
    tip.id = 'gemTooltip';
    tip.textContent = "💎 Gems – Zum Kaufen von Lootboxen.";
    Object.assign(tip.style, {
      position: 'fixed',
      top: '45px',
      left: '15px',
      background: 'rgba(0,0,0,0.85)',
      color: 'gold',
      padding: '8px 12px',
      borderRadius: '6px',
      fontSize: '13px',
      fontFamily: 'Orbitron, sans-serif',
      boxShadow: '0 0 10px rgba(255, 206, 0, 0.4)',
      zIndex: '9999'
    });
    document.body.appendChild(tip);
  });

  gemDisplay.addEventListener('mouseleave', () => {
    document.getElementById('gemTooltip')?.remove();
  });

  // 🪙 Sigma Coins
  function getSigmaCoins() {
    return parseInt(localStorage.getItem('sigmaCoins') || '0', 10);
  }

  const sigmaDisplay = document.createElement('div');
  sigmaDisplay.id = 'sigmaDisplay';
  Object.assign(sigmaDisplay.style, {
    position: 'fixed',
    top: '60px',
    left: '15px',
    zIndex: '999',
    background: 'rgba(0, 0, 0, 0.5)',
    padding: '6px 12px',
    borderRadius: '8px',
    fontSize: '16px',
    color: '#00e5ff',
    fontFamily: 'Orbitron, sans-serif',
    boxShadow: '0 0 8px rgba(0, 229, 255, 0.5)',
    cursor: 'default'
  });
  document.body.appendChild(sigmaDisplay);

  function updateSigmaDisplay() {
    sigmaDisplay.innerHTML = `🪙 <strong>${getSigmaCoins()}</strong>`;
  }
  updateSigmaDisplay();
  window.updateSigmaDisplay = updateSigmaDisplay;

  sigmaDisplay.addEventListener('mouseenter', () => {
    const tooltip = document.createElement('div');
    tooltip.id = 'sigmaTooltip';
    tooltip.textContent = "🪙 Sigma Coins – bekommst du durch Cases Im Shop einlösbar.";
    const rect = sigmaDisplay.getBoundingClientRect();
    Object.assign(tooltip.style, {
      position: 'fixed',
      top: `${rect.bottom + 5}px`,
      left: `${rect.left}px`,
      background: 'rgba(0,0,0,0.85)',
      color: '#00e5ff',
      padding: '8px 12px',
      borderRadius: '6px',
      fontSize: '13px',
      fontFamily: 'Orbitron, sans-serif',
      boxShadow: '0 0 10px rgba(0, 229, 255, 0.4)',
      zIndex: '9999'
    });
    document.body.appendChild(tooltip);
  });

  sigmaDisplay.addEventListener('mouseleave', () => {
    document.getElementById('sigmaTooltip')?.remove();
  });
});




    let selectedPassive = 'swordfighter';

    document.addEventListener('DOMContentLoaded', () => {
      // Partikel erstellen
      const particlesContainer = document.getElementById('particles');
      for (let i = 0; i < 30; i++) {
        createParticle(particlesContainer);
      }

      const passiveOptions = document.querySelectorAll('.passive-option');

      // Aktuelle Auswahl auslesen, falls schon vorhanden
      const initiallySelected = document.querySelector('.passive-option.active');
      if (initiallySelected && !initiallySelected.classList.contains('locked')) {
        selectedPassive = initiallySelected.dataset.passive;
      }

      /* Audio-Effekte erstellen
      const hoverSound = new Audio();
      hoverSound.volume = 0.2;
      
      const clickSound = new Audio();
      clickSound.volume = 0.3;
      
      try {
        hoverSound.src = '';
        clickSound.src = '';
      } catch(e) {
        console.error("Audio-Effekte konnten nicht geladen werden:", e);
      }  */

      // Passiven-Auswahl aktivieren
      passiveOptions.forEach(option => {
        option.addEventListener('mouseover', () => {
          if (option.classList.contains('locked')) return;
          try { hoverSound.play(); } catch(e) {}
          
          const allCards = document.querySelectorAll('.passive-option');
          allCards.forEach(card => {
            if (card !== option && !card.classList.contains('active')) {
              card.style.transform = 'scale(0.95)';
              card.style.opacity = '0.7';
            }
          });
        });

        option.addEventListener('mouseout', () => {
          const allCards = document.querySelectorAll('.passive-option');
          allCards.forEach(card => {
            if (!card.classList.contains('active')) {
              card.style.transform = '';
              card.style.opacity = '';
            }
          });
        });

        option.addEventListener('click', () => {
          if (option.classList.contains('locked')) return;
          
          try { clickSound.play(); } catch(e) {}

          passiveOptions.forEach(el => {
            el.classList.remove('active');
            el.style.transform = '';
            el.style.opacity = '';
          });
          
          option.classList.add('active');
          selectedPassive = option.dataset.passive;
          
          // Visueller Effekt beim Klick
          const ripple = document.createElement('div');
          ripple.style.position = 'absolute';
          ripple.style.width = '5px';
          ripple.style.height = '5px';
          ripple.style.borderRadius = '50%';
          ripple.style.backgroundColor = 'rgba(255, 206, 0, 0.7)';
          ripple.style.top = '50%';
          ripple.style.left = '50%';
          ripple.style.transform = 'translate(-50%, -50%)';
          ripple.style.animation = 'ripple 0.7s linear';
          
          option.appendChild(ripple);
          
          setTimeout(() => {
            option.removeChild(ripple);
          }, 700);
          
          console.log("🧠 Ausgewählte Passive:", selectedPassive);
        });
      });

      // Neues Spiel starten mit Animation
      window.startGame = function() {
        const nameInput = document.getElementById('playerNameInput');
        const playerName = nameInput?.value.trim();

        if (!playerName || playerName.length < 1) {
          alert("Bitte gib einen gültigen Namen ein (max. 15 Zeichen).");
          return;
        }

        localStorage.setItem('playerName', playerName);
        localStorage.setItem('selectedPassive', selectedPassive);

        console.log("🎮 Spielername:", playerName);
        console.log("🔒 Gespeicherte Passive:", selectedPassive);

        // Animation beim Start
        const menuContainer = document.getElementById('mainMenu');
        menuContainer.style.opacity = '0';
        menuContainer.style.transform = 'scale(1.1)';

        try { clickSound.play(); } catch(e) {}

        setTimeout(() => {
          window.location.href = 'spiel.html';
        }, 800);
      };


      // Tastatur-Event für Enter-Taste
      document.getElementById('playerNameInput').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
          startGame();
        }
      });

      // Button Animation hinzufügen
      const startButton = document.getElementById('startButton');
      startButton.addEventListener('mousemove', function(e) {
        const x = e.pageX - this.offsetLeft;
        const y = e.pageY - this.offsetTop;
        
        this.style.setProperty('--x', x + 'px');
        this.style.setProperty('--y', y + 'px');
      });

      // Freigeschaltete Passiven anzeigen
      function unlockPassive(passiveId) {
        const elem = document.querySelector(`[data-passive="${passiveId}"]`);
        if (!elem) return;

        elem.classList.remove('locked');

        if (!elem.querySelector('.new-badge')) {
          const badge = document.createElement('div');
          badge.className = 'new-badge';
          badge.textContent = 'NEU!';
          elem.appendChild(badge);
        }
      }

      // Unlock-Status prüfen
      if (localStorage.getItem('unlockedGoldboy') === 'true') unlockPassive('goldboy');
      if (localStorage.getItem('unlockedDragonscale') === 'true') unlockPassive('dragonscale');
      if (localStorage.getItem('unlockedUndead') === 'true') unlockPassive('undead');
    });

    // Funktion zum Erstellen von Partikeln
    function createParticle(container) {
      const particle = document.createElement('div');
      particle.classList.add('particle');
      
      // Zufällige Position, Größe und Verzögerung
      const size = Math.random() * 3 + 1;
      const posX = Math.random() * window.innerWidth;
      const posY = Math.random() * window.innerHeight + window.innerHeight;
      const delay = Math.random() * 20;
      const duration = Math.random() * 10 + 15;
      const brightness = Math.random() * 80 + 20;
      
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      particle.style.left = `${posX}px`;
      particle.style.top = `${posY}px`;
      particle.style.opacity = Math.random() * 0.3;
      particle.style.animationDuration = `${duration}s`;
      particle.style.animationDelay = `${delay}s`;
      particle.style.filter = `brightness(${brightness}%)`;
      
      container.appendChild(particle);
      
      // Partikel nach Animation neu erstellen
      setTimeout(() => {
        container.removeChild(particle);
        createParticle(container);
      }, (delay + duration) * 1000);
    }

    // Stelle sicher, dass wir auch Partikel erstellen, wenn DOMContentLoaded bereits ausgelöst wurde
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      const particlesContainer = document.getElementById('particles');
      if (particlesContainer) {
        for (let i = 0; i < 30; i++) {
          createParticle(particlesContainer);
        }
      }
    }

    // Style-Element für die Ripple-Animation erstellen
    const styleElement = document.createElement('style');
    styleElement.textContent = `
      @keyframes ripple {
        0% {
          width: 5px;
          height: 5px;
          opacity: 1;
        }
        100% {
          width: 300px;
          height: 300px;
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(styleElement);


// Globale Highscores aus Firestore anzeigen
db.collection("highscores")
  .orderBy("score", "desc")
  .limit(10)
  .get()
  .then(snapshot => {
    const leaderboardList = document.getElementById('leaderboardList');
    leaderboardList.innerHTML = '';
    snapshot.forEach(doc => {
      const entry = doc.data();
      const li = document.createElement('li');
      li.textContent = `${entry.name.padEnd(12)} - ${entry.score} Kills (Lvl ${entry.level})`;
      leaderboardList.appendChild(li);
    });
  })
  .catch(err => {
    console.warn("⚠️ Highscore konnte nicht geladen werden:", err);
  });


  const monsters = [
                { name: 'Goblin', health: 20, attack: 5, levelMin: 1, levelMax: 4, xp: 35, gold: 60, pixelImageKey: 'Goblin', gemChance: 1, description: 'Ein kleiner, flinker Goblin.', traits: ['Keine Fähigkeit'] },
                { name: 'Schleim', health: 20, attack: 6, levelMin: 1, levelMax: 4, xp: 65, gold: 85, pixelImageKey: 'Schleim', gemChance: 1, description: 'Ein fieser Schleim.', traits: ['Teilung'] },
                { name: 'Gepanzertes Skelett', health: 25, attack: 4, levelMin: 2, levelMax: 6, xp: 55, gold: 75, pixelImageKey: 'armorskelett', gemChance: 2, description: 'Ein ehmaliger stolzer Soldat.', traits: ['Rüstung'] },
                { name: 'Leecher', health: 30, attack: 6, levelMin: 2, levelMax: 6, xp: 55, gold: 75, pixelImageKey: 'Leecher', gemChance: 2, description: 'Blutsüchtiger Mini Dämonen.', traits: ['Vamp'] },
                { name: 'Wutferkel', health: 35, attack: 8, levelMin: 3, levelMax: 6, xp: 65, gold: 80, pixelImageKey: 'pig', gemChance: 2, description: 'Ein Wildes wütendes Schwein', traits: ['Rücksichtslos'] },
                { name: 'Ork', health: 35, attack: 5, levelMin: 3, levelMax: 7, xp: 60, gold: 65, pixelImageKey: 'Ork', gemChance: 4, description: 'Ein brutaler Ork-Krieger.', traits: ['Stark'] },
                { name: 'Riesen Spinne', health: 40, attack: 6, levelMin: 4, levelMax: 9, xp: 65, gold: 80, pixelImageKey: 'spinne', gemChance: 4, description: 'Spuckt lähmendes Gift.', traits: ['Giftig'] }, 
                { name: 'Bagdos Krieger', health: 45, attack: 7, levelMin: 5, levelMax: 9, xp: 68, gold: 85, pixelImageKey: 'krieger', gemChance: 5, description: 'Ein Lakeie Bagods.', traits: ['Krieger'] }, 
                { name: 'Troll', health: 47, attack: 8, levelMin: 5, levelMax: 9, xp: 70, gold: 100, pixelImageKey: 'Troll', gemChance: 5, description: 'Regeneriert 3 Leben pro Runde.', traits: ['Regeneration', 'Massiv'], regen: 3 }, 
                { name: 'Donnerschlange', health: 45, attack: 9, levelMin: 6, levelMax: 10, xp: 120, gold: 105, pixelImageKey: 'snake', gemChance: 5, description: 'Eine lähmende Donnerschlange', traits: ['Statisch'] },
                { name: 'Bagdos Magier', health: 45, attack: 9, levelMin: 6, levelMax: 11, xp: 120, gold: 105, pixelImageKey: 'magier', gemChance: 5, description: 'Bagdos treuster Magier', traits: ['Feueratem', 'Vision'] },
                { name: 'Nekromant', health: 50, attack: 7, levelMin: 8, levelMax: 12, xp: 80, gold: 120, pixelImageKey: 'Nekromant', gemChance: 6, description: 'Schwächt dich oder ruft Diener.', traits: ['Untotenbeschwörer'] }, // Effekte müssen implementiert werden
                { name: 'Eiskönig', health: 65, attack: 10, levelMin: 9, levelMax: 13, xp: 100, gold: 130, pixelImageKey: 'Eiskönig', gemChance: 6, description: 'Verlangsamt dich mit Kälte.', traits: ['Eis-Elementar', 'Frost-Aura'] }, // Effekte müssen implementiert werden
                { name: 'Alchemie Kobold', health: 60, attack: 10, levelMin: 10, levelMax: 15, xp: 110, gold: 140, pixelImageKey: 'alchemiekobold', gemChance: 7, description: 'Der Albtraum jeder Medizin (fast jeder).', traits: ['Giftig', 'Antiheal'] }, // Effekte müssen implementiert werden
                { name: 'Baby Drache', health: 65, attack: 13, levelMin: 11, levelMax: 15, xp: 130, gold: 170, pixelImageKey: 'babyDrache', gemChance: 7, description: 'Speit Feuerstöße.', traits: ['Verspielt', 'Feueratem'] }, // Effekte müssen implementiert werden
                { name: 'Charged Golem', health: 75, attack: 12, levelMin: 12, levelMax: 16, xp: 170, gold: 180, pixelImageKey: 'Golem', gemChance: 7, description: 'Mächtiger Elementar Golem.', traits: ['Statisch', 'Regeneration'], regen: 3 }, // Effekte müssen implementiert werden
                { name: 'Dracula', health: 68, attack: 10, levelMin: 13, levelMax: 17, xp: 190, gold: 190, pixelImageKey: 'drakula', gemChance: 8, description: 'Dein Blut macht ihn stärker.', traits: ['Vamp', 'Stark'] }, // Effekte müssen implementiert werden
                { name: 'Dämon', health: 85, attack: 13, levelMin: 14, levelMax: 18, xp: 280, gold: 210, pixelImageKey: 'Demon', gemChance: 9, description: 'Feuer und Schatten. Resistent.', traits: ['Höllen Krallen'] }, // Effekte müssen implementiert werden
                { name: 'Verfluchter Ritter', health: 85, attack: 10, levelMin: 15, levelMax: 19, xp: 360, gold: 250, pixelImageKey: 'CursedKnight', gemChance: 10, description: 'Ein wandelnde Geisterrüstung', traits: ['Rüstung', 'Krieger']}, // Effekte müssen implementiert werden
                { name: 'Bagdos Riese', health: 120, attack: 12, levelMin: 16, levelMax: 20, xp: 400, gold: 300, pixelImageKey: 'riese', gemChance: 10, description: 'Ein Dummer aber leider auch starker Riese', traits: ['Stark', 'Dämlich'] }, // Effekte müssen implementiert werden
                { name: 'Erzengel', health: 110, attack: 13, levelMin: 16, levelMax: 20, xp: 400, gold: 300, pixelImageKey: 'Erzengel', gemChance: 10, description: 'Ein mächtiger gefallener Engel.', traits: ['Segen', 'Fliegend'] }, // Effekte müssen implementiert werden
                { name: 'Gargoyle', health: 105, attack: 15, levelMin: 17, levelMax: 21, xp: 450, gold: 320, pixelImageKey: 'Gargoyle', gemChance: 11, description: 'Einst da um die Menschen zu beschützen. Jetzt ein unbändiges Monster', traits: ['Gepanzerte Schuppen', 'Tank'] }, 
                { name: 'Drache', health: 130, attack: 16, levelMin: 18, levelMax: 22, xp: 650, gold: 330, pixelImageKey: 'Drache', gemChance: 12, description: 'Ein mächtiger, alter Drache.', traits: ['Feueratem', 'Fliegend', 'Gepanzerte Schuppen'] }, 
                { name: 'Teufel', health: 95, attack: 7, levelMin: 19, levelMax: 24, xp: 750, gold: 380, pixelImageKey: 'Teufel', gemChance: 13, description: 'Der Herrscher der Unterwelt.', traits: ['Höllenwache'] },
                { name: 'Spinnenkönigin', health: 130, attack: 14, levelMin: 20, levelMax: 25, xp: 750, gold: 390, pixelImageKey: 'spinnenboss', gemChance: 14, description: 'Eine Spinne die selbst der Teufel fürchtet.', traits: ['Antiheal', 'Giftig'] },
                { name: 'Rainbow', health: 150, attack: 13, levelMin: 21, levelMax: 26, xp: 900, gold: 400, pixelImageKey: 'Rainbow', gemChance: 16, description: 'Meister über alle Elemente', traits: ['Frost-Aura', 'Giftig', 'Feueratem', 'Statisch'] },
                { name: 'Bagdos Leibgarde', health: 180, attack: 17, levelMin: 21, levelMax: 26, xp: 900, gold: 400, pixelImageKey: 'leibgarde', gemChance: 16, description: 'Lässt seinen Meister nie im stich', traits: ['Rüstung', 'Tank'] },
                { name: 'Yokai', health: 110, attack: 16, levelMin: 22, levelMax: 28, xp: 1100, gold: 450, pixelImageKey: 'Yokai', gemChance: 16, description: 'Ein hochrangiger fliegender Yokai-Demon', traits: ['Fliegend', 'Höllenkrallen','Untotenbeschwörer'] },
                { name: 'Yagdril', health: 150, attack: 28, levelMin: 23, levelMax: 100, xp: 1200, gold: 500, pixelImageKey: 'Yagdril', gemChance: 18, description: 'Ein Wesen dessen Macht unbeschreiblich ist', traits: ['Fliegend', 'YinYang'] },
                { name: 'Leviathan', health: 160, attack: 20, levelMin: 24, levelMax: 100, xp: 1300, gold: 520, pixelImageKey: 'Leviathan', gemChance: 23, description: 'Das Symbol des Schreckens', traits: ['Antiheal', 'Vision'] },
                { name: 'Bagdo', health: 200, maxHealth: 200, attack: 30, levelMin: 25, levelMax: 100, xp: 1500, gold: 600, pixelImageKey: 'Bagdo', gemChance: 25, description: 'Der gefallene Lichking', traits: ['Entfesselung', 'Lichking'] },
];

document.getElementById("monsterWikiButton").addEventListener("click", function () {
  const container = document.getElementById("monsterList");
  container.innerHTML = monsters.map(monster => `
   <div style="display: flex; align-items: center; gap: 15px; padding: 10px 0; border-bottom: 1px solid #333;">
      <img src="images/${monster.pixelImageKey}.png" alt="${monster.name}" style="width: 48px; height: 48px; image-rendering: pixelated;" />
      <div>
        <strong>${monster.name}</strong> (Lvl ${monster.levelMin}-${monster.levelMax})<br/>
        ❤️ ${monster.health} | 🗡️ ${monster.attack} | ⭐ Spawn Level: ${monster.levelMin} | 💰 ${monster.gold}<br/>
        🧬 Traits: ${monster.traits.join(', ')}
      </div>
    </div>
  `).join('');
  document.getElementById("monsterWikiModal").style.display = "block";
});

function closeMonsterWiki() {
  document.getElementById("monsterWikiModal").style.display = "none";
}

const cards = [
                 { id: 1, name: 'Schwert', icon: '⚔️', description: 'Ein einfaches Schwert.', power: 5, effect: 'damage', manaCost: 2, weight: 11, tags: ['damage'] },
                 { id: 2, name: 'Schild', icon: '🛡️', description: 'Erhalte 5 Block', power: 5, effect: 'block', manaCost: 2, weight: 1 },
                 { id: 3, name: 'Heilung', icon: '❤️', description: 'Heilt 8 Leben', power: 8, effect: 'heal', manaCost: 3, weight: 1 },
                 { id: 4, name: 'Gift', icon: '☠️', description: 'Vergiftung (3 Schaden, 3 Rd.)', power: 3, duration: 3, effect: 'poison', manaCost: 2, weight: 1 },
                 { id: 5, name: 'Blitz', icon: '⚡', description: '12 Schaden, Paralysiert Gegner zu 45% (Halbiert den Angriff 2 Runden)', power: 12, effect: 'damage_paralyze', manaCost: 4, weight: 2 },
                 { id: 6, name: 'Großer Schlag', icon: '💥', description: 'Fügt 15 Schaden zu', power: 15, effect: 'damage', manaCost: 4, weight: 2 },
                 { id: 7, name: 'Meditieren', icon: '🧘', description: 'Ziehe 1 Karte', power: 1, effect: 'draw', manaCost: 0, weight: 1 },
                 { id: 8, name: 'Vampirbiss', icon: '🧛', description: '8 Schaden, heilt 8', power: 8, healAmount: 8, effect: 'lifesteal', manaCost: 4, weight: 2 }, // Direkte Heilung statt %
                 { id: 9, name: 'Manatrank', icon: '🧪', description: 'Erhalte 2 Mana', power: 2, effect: 'gain_mana', manaCost: 0, weight: 3 },
                 { id: 10, name: 'Fokus', icon: '🎯', description: 'Ziehe 2 Karten', power: 2, effect: 'draw', manaCost: 1, weight: 1 },
                 { id: 11, name: 'Heilige Macht', icon: '✨', description: 'Fügt 25 Schaden zu', power: 25, effect: 'damage', manaCost: 6, weight: 1 },
                 { id: 12, name: 'Genesung', icon: '💖', description: 'Heilt 15 Leben', power: 15, effect: 'heal', manaCost: 5, weight: 1 },
                 {id: 13, name: 'Feuerpfeil', icon: '🔥', description: 'Fügt 12 Schaden zu. 50% Chance auf Verbrennung (5 Schaden für 2 Runden).', power: 12, effect: 'firearrow', manaCost: 5, weight: 2},
                 {id: 14, name: 'Gambler’s Luck', icon: '🎲', description: 'Gegner nimmt 5 Schaden und du erhältst 100 Gold (Ignoriert Block) oder Du nimmst 5 Schaden.', power: 5, effect: 'gamble', manaCost: 0, weight: 1},
                 { id: 15, name: 'Kraft Sammeln', icon: '🔋', description: 'Heilt dich um dein gesamtes Mana.<br><br>Einmaliger Schadensboost i.H.v. Manakosten -1', power: 0, effect: 'power_surge', manaCost: 'X', weight: 1 },
                 {id: 16, name: 'Klingenwirbel', icon: '🌀', description: 'Greift mehrere Gegner gleichzeitig an. (Ignoriert Block.)', power: 8, effect: 'whirlwind', manaCost: 3, weight: 2},
                 {id: 17, name: 'Todesklinge', icon: '⚔️', description: 'Die stärkste aller Schwerter. 25 Schaden.', power: 25, effect: 'damage', manaCost: 4, weight: 1, tags: ['sword'], rarity: 'superrare'},
                 {id: 18, name: 'Mana Oase', icon: '🧪', description: 'Erhalte 5 Mana', power: 5, effect: 'gain_mana', manaCost: 0, weight: 1, rarity: 'superrare'},
                 {id: 19, name: 'Blutrausch', icon: '🧛', description: '20 Schaden, heilt 12', power: 20, healAmount: 12, effect: 'lifesteal', manaCost: 7, weight: 1, rarity: 'superrare'},
                 {id: 20, name: 'Unwetter', icon: '🌩️', description: 'Paralysiere den Gegner (Halbiert den Angriff 2 Runden)', power: 0, effect: 'paralyze', manaCost: 1, weight: 2 },
                 {id: 21, name: 'Ansturm', icon: '🐗', description: 'Ein Rücksichtsloser Angriff, 15 schaden aber 5 Schaden Rückstoß', power: 15, selfDamage: 5, effect: 'damage_selfhit', manaCost: 3, weight: 1 },
                 {id: 22, name: 'Tornado', icon: '🌪️', description: 'Kann 2-3x treffen je 5 Schaden. Umgeht Block', power: 5, effect: 'multi_hit', hits: 3, minHits: 2, manaCost: 3, weight: 2 },
                 {id: 23, name: 'The Knive', icon: '🗡️', description: 'Verursacht Blutungen. Der Gegner bekommt durch The Knive doppelten Schaden bis zum Tod', power: 12, effect: 'bleed', manaCost: 4, weight: 3 },
                 {id: 24, name: 'Biohazard', icon: '☣️', description: 'Verursacht Schwere Vergiftung.(6 Schaden, 3 Rd.)', power: 6, duration: 3, effect: 'poison', manaCost: 4, weight: 1 },
];

document.getElementById("cardWikiButton").addEventListener("click", function () {
  const container = document.getElementById("cardList");
  container.innerHTML = cards.map(card => `
    <div style="
      background: linear-gradient(145deg, var(--card-bg), #2a2a3a);
      border: 2px solid ${card.rarity === 'superrare' ? 'gold' : '#444'};
      border-radius: 12px;
      padding: 12px;
      font-size: 14px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    ">
      <div style="font-size: 22px;">${card.icon}</div>
      <strong>${card.name}</strong><br/>
      <small style="color: var(--text-secondary);">${card.description}</small><br/>
      <div style="margin-top: 6px;">
        💥 Power: ${card.power} <br/>
        🔮 Mana: ${card.manaCost} <br/>
        🧠 Effekt: ${card.effect}
      </div>
    </div>
  `).join('');
  document.getElementById("cardWikiModal").style.display = "block";
});

function closeCardWiki() {
  document.getElementById("cardWikiModal").style.display = "none";
}

function openPatchNotes() {
  const modal = document.getElementById("patchNotesModal");
  const isOpen = modal.style.display === "block";
  modal.style.display = isOpen ? "none" : "block";
}


//Starter deck
window.showStarterDeckSelection = function () {
  const allCards = (window.cards && Array.isArray(window.cards)) ? window.cards : null;
  if (!allCards || allCards.length === 0) {
    alert("⚠️ Kartenliste nicht geladen. Bitte lade die Seite neu.");
    return;
  }

  const DEFAULT_STARTERS = [1, 2, 3, 7, 15, 16];
  const wonCards = JSON.parse(localStorage.getItem('wonCards') || '[]');
  const allowedStarterCardIds = [...new Set([...DEFAULT_STARTERS, ...wonCards])];

  const selected = new Set(JSON.parse(localStorage.getItem('starterDeck') || '[]'));

  const modal = document.createElement('div');
  modal.id = 'starterDeckModal';
  modal.style = `
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.8);
    z-index: 10000;
    display: flex; align-items: center; justify-content: center;
  `;

  const container = document.createElement('div');
  container.style = `
    background: #1a1a24;
    border: 2px solid gold;
    padding: 25px;
    border-radius: 12px;
    max-width: 900px;
    width: 95%;
    color: white;
    text-align: center;
    box-shadow: 0 0 20px gold;
    font-family: 'Orbitron', sans-serif;
  `;

  const title = document.createElement('h2');
  title.textContent = '🎴 Wähle dein Starter-Deck (5 Karten)';
  container.appendChild(title);

  const cardGrid = document.createElement('div');
  cardGrid.style = `
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
  `;

  const handDisplay = document.createElement('div');
  handDisplay.style = `
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 30px;
    min-height: 160px;
  `;

  const handSlots = [];
  for (let i = 0; i < 5; i++) {
    const slot = document.createElement('div');
    slot.style = `
      width: 110px;
      height: 160px;
      border: 2px dashed #666;
      border-radius: 8px;
      background-color: rgba(255,255,255,0.05);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      color: #999;
    `;
    slot.textContent = '🃏';
    handDisplay.appendChild(slot);
    handSlots.push(slot);
  }

  // Karten anzeigen
  allowedStarterCardIds.forEach(id => {
    const card = allCards.find(c => c.id === id);
    if (!card) return;

    const cardEl = document.createElement('div');
    cardEl.style = `
      width: 140px;
      height: 200px;
      padding: 10px;
      border-radius: 10px;
      border: 2px solid ${selected.has(id) ? 'gold' : '#444'};
      background: linear-gradient(145deg, #1a1a24, #2a2a3a);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: transform 0.2s ease;
      transform: ${selected.has(id) ? 'scale(1.05)' : 'scale(1)'};
    `;

    cardEl.innerHTML = `
      <div style="font-size: 22px;">${card.icon}</div>
      <strong style="font-size: 12px;">${card.name}</strong>
      <small style="font-size: 10px; text-align: center;">${card.description}</small>
      <div style="font-size: 8px; color: #ccc;">Mana: ${card.manaCost}</div>
    `;

    cardEl.onclick = () => {
      if (selected.has(id)) {
        selected.delete(id);
        cardEl.style.borderColor = '#444';
        cardEl.style.transform = 'scale(1)';
      } else {
        if (selected.size < 5) {
          selected.add(id);
          cardEl.style.borderColor = 'gold';
          cardEl.style.transform = 'scale(1.05)';
        }
      }
      updateHandDisplay();
    };

    cardGrid.appendChild(cardEl);
  });

  function updateHandDisplay() {
    const current = Array.from(selected);
    handSlots.forEach((slot, i) => {
      const cardId = current[i];
      const card = allCards.find(c => c.id === cardId);
      if (card) {
        slot.innerHTML = `
          <div style="font-size: 22px;">${card.icon}</div>
          <small style="font-size: 11px;">${card.name}</small>
        `;
        slot.style.border = '2px solid gold';
        slot.style.color = 'white';
      } else {
        slot.textContent = '🃏';
        slot.style.border = '2px dashed #666';
        slot.style.color = '#999';
      }
    });
  }

  const warningText = document.createElement('div');
  warningText.style = 'color: red; margin-top: 10px; font-size: 14px;';
  warningText.textContent = '';

  const confirmBtn = document.createElement('button');
  confirmBtn.textContent = '✅ Speichern';
  confirmBtn.style = 'margin-top: 20px; padding: 10px 20px; font-size: 16px;';
  confirmBtn.onclick = () => {
    if (selected.size !== 5) {
      warningText.textContent = '❗ Bitte wähle genau 5 Karten aus.';
      return;
    }
    localStorage.setItem('starterDeck', JSON.stringify(Array.from(selected)));
    modal.remove();
    location.reload();
  };

  const cancelBtn = document.createElement('button');
  cancelBtn.textContent = '❌ Abbrechen';
  cancelBtn.style = 'margin-top: 20px; margin-left: 10px; padding: 10px 20px; font-size: 16px;';
  cancelBtn.onclick = () => modal.remove();

  container.appendChild(cardGrid);
  container.appendChild(handDisplay);
  container.appendChild(warningText);
  container.appendChild(confirmBtn);
  container.appendChild(cancelBtn);
  modal.appendChild(container);
  document.body.appendChild(modal);

  // ESC zum Schließen
  const escListener = (e) => {
    if (e.key === 'Escape') {
      modal.remove();
      document.removeEventListener('keydown', escListener);
    }
  };
  document.addEventListener('keydown', escListener);

  updateHandDisplay();
};

// Karte global verfügbar machen für Starterdeck etc.
window.cards = cards;
localStorage.setItem('allCards', JSON.stringify(cards));

  </script>
<script src="card.data.js"></script>
<script src="lootbox.js"></script>
<script src="indexshop.js"></script> 
<script src="achievements.js"></script>
<script>
  function toggleMenu() {
    const menu = document.getElementById('menuDropdown');
    if (!menu) return;
    menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
  }
</script>



</body>
</html>